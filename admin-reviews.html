<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Admin Panel - Kienyeji Wooden Rest</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #faf8f5;
            line-height: 1.6;
        }
        .admin-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(44, 24, 16, 0.1);
        }
        h1 {
            color: #8B4513;
            text-align: center;
            margin-bottom: 30px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #8B4513, #CD853F);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }
        .review-item {
            border: 1px solid #ddd;
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            background: #faf8f5;
            transition: all 0.3s ease;
        }
        .review-item:hover {
            box-shadow: 0 5px 15px rgba(44, 24, 16, 0.1);
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .reviewer-info {
            flex-grow: 1;
        }
        .reviewer-name {
            font-weight: bold;
            color: #8B4513;
            font-size: 1.1rem;
        }
        .review-meta {
            font-size: 0.9rem;
            color: #666;
            margin: 5px 0;
        }
        .review-rating {
            color: #FFD700;
            font-size: 1.2rem;
        }
        .review-comment {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-style: italic;
            border-left: 4px solid #CD853F;
        }
        .review-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .btn-verify {
            background-color: #28a745;
            color: white;
        }
        .btn-verify:hover {
            background-color: #218838;
        }
        .btn-unverify {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-unverify:hover {
            background-color: #e0a800;
        }
        .btn-delete {
            background-color: #dc3545;
            color: white;
        }
        .btn-delete:hover {
            background-color: #c82333;
        }
        .btn-edit {
            background-color: #007bff;
            color: white;
        }
        .btn-edit:hover {
            background-color: #0056b3;
        }
        .verified-badge {
            background-color: rgba(34, 139, 34, 0.1);
            color: #228B22;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .filter-btn {
            background-color: #e9ecef;
            color: #495057;
            border: 2px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        .filter-btn.active {
            background-color: #8B4513;
            color: white;
            border-color: #8B4513;
        }
        .edit-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #007bff;
        }
        .edit-form input, .edit-form textarea, .edit-form select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }
        .edit-form textarea {
            resize: vertical;
            height: 100px;
        }
        .hidden { display: none; }
        
        @media (max-width: 768px) {
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .review-actions {
                width: 100%;
                justify-content: center;
            }
            .stats {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-panel">
        <h1>üè® Review Management System</h1>
        
        <div class="stats" id="stats">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <div class="filters">
            <h3>Filter Reviews:</h3>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterReviews('all')">All Reviews</button>
                <button class="filter-btn" onclick="filterReviews('verified')">‚úÖ Verified</button>
                <button class="filter-btn" onclick="filterReviews('unverified')">‚è≥ Unverified</button>
                <button class="filter-btn" onclick="filterReviews('recent')">üïê Recent (7 days)</button>
            </div>
        </div>

        <div id="status"></div>
        
        <div id="reviewList">
            <!-- Reviews will be populated by JavaScript -->
        </div>
    </div>

    <script>
        let reviews = [];
        let currentFilter = 'all';
        let editingReview = null;

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
            setTimeout(() => {
                statusDiv.innerHTML = '';
                statusDiv.className = '';
            }, 5000);
        }

        function loadReviews() {
            const storedReviews = localStorage.getItem('kienyeji-reviews');
            if (storedReviews) {
                reviews = JSON.parse(storedReviews);
            } else {
                reviews = [];
            }
            updateStats();
            displayReviews();
        }

        function saveReviews() {
            localStorage.setItem('kienyeji-reviews', JSON.stringify(reviews));
            updateStats();
            displayReviews();
        }

        function updateStats() {
            const totalReviews = reviews.length;
            const verifiedReviews = reviews.filter(r => r.verified).length;
            const averageRating = totalReviews > 0 
                ? (reviews.reduce((sum, r) => sum + r.rating, 0) / totalReviews).toFixed(1)
                : 0;
            const recentReviews = reviews.filter(r => {
                const reviewDate = new Date(r.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return reviewDate >= weekAgo;
            }).length;

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <span class="stat-number">${totalReviews}</span>
                    <span>Total Reviews</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${verifiedReviews}</span>
                    <span>Verified Reviews</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${averageRating}</span>
                    <span>Average Rating</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${recentReviews}</span>
                    <span>Recent Reviews</span>
                </div>
            `;
        }

        function filterReviews(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayReviews();
        }

        function getFilteredReviews() {
            let filtered = [...reviews];
            
            switch(currentFilter) {
                case 'verified':
                    filtered = reviews.filter(r => r.verified);
                    break;
                case 'unverified':
                    filtered = reviews.filter(r => !r.verified);
                    break;
                case 'recent':
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    filtered = reviews.filter(r => new Date(r.date) >= weekAgo);
                    break;
            }
            
            return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        function displayReviews() {
            const filteredReviews = getFilteredReviews();
            const reviewListDiv = document.getElementById('reviewList');
            
            if (filteredReviews.length === 0) {
                reviewListDiv.innerHTML = '<p><em>No reviews found for the current filter</em></p>';
                return;
            }

            reviewListDiv.innerHTML = filteredReviews.map(review => `
                <div class="review-item" id="review-${review.id}">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-name">${escapeHtml(review.name)}</div>
                            <div class="review-meta">
                                üìß ${escapeHtml(review.email)} | üìÖ ${formatDate(review.date)}
                                ${review.verified ? '<span class="verified-badge">‚úÖ Verified Stay</span>' : ''}
                            </div>
                            <div class="review-rating">${generateStars(review.rating)}</div>
                        </div>
                    </div>
                    
                    <div class="review-comment">"${escapeHtml(review.comment)}"</div>
                    
                    <div class="review-actions">
                        ${review.verified 
                            ? `<button class="btn-unverify" onclick="toggleVerification('${review.id}', false)">‚ùå Unverify</button>`
                            : `<button class="btn-verify" onclick="toggleVerification('${review.id}', true)">‚úÖ Verify</button>`
                        }
                        <button class="btn-edit" onclick="editReview('${review.id}')">‚úèÔ∏è Edit</button>
                        <button class="btn-delete" onclick="deleteReview('${review.id}')">üóëÔ∏è Delete</button>
                    </div>
                    
                    <div id="edit-form-${review.id}" class="edit-form hidden">
                        <!-- Edit form will be populated when editing -->
                    </div>
                </div>
            `).join('');
        }

        function toggleVerification(reviewId, verified) {
            const reviewIndex = reviews.findIndex(r => r.id === reviewId);
            if (reviewIndex !== -1) {
                reviews[reviewIndex].verified = verified;
                saveReviews();
                showStatus(`Review ${verified ? 'verified' : 'unverified'} successfully!`, 'success');
            }
        }

        function editReview(reviewId) {
            const review = reviews.find(r => r.id === reviewId);
            if (!review) return;

            editingReview = reviewId;
            const editFormDiv = document.getElementById(`edit-form-${reviewId}`);
            
            editFormDiv.innerHTML = `
                <h4>Edit Review</h4>
                <input type="text" id="edit-name-${reviewId}" value="${escapeHtml(review.name)}" placeholder="Name">
                <input type="email" id="edit-email-${reviewId}" value="${escapeHtml(review.email)}" placeholder="Email">
                <select id="edit-rating-${reviewId}">
                    <option value="1" ${review.rating === 1 ? 'selected' : ''}>‚≠ê (1)</option>
                    <option value="2" ${review.rating === 2 ? 'selected' : ''}>‚≠ê‚≠ê (2)</option>
                    <option value="3" ${review.rating === 3 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê (3)</option>
                    <option value="4" ${review.rating === 4 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê (4)</option>
                    <option value="5" ${review.rating === 5 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</option>
                </select>
                <textarea id="edit-comment-${reviewId}" placeholder="Comment">${escapeHtml(review.comment)}</textarea>
                <div>
                    <button class="btn-verify" onclick="saveEdit('${reviewId}')">üíæ Save Changes</button>
                    <button class="btn-unverify" onclick="cancelEdit('${reviewId}')">‚ùå Cancel</button>
                </div>
            `;
            
            editFormDiv.classList.remove('hidden');
        }

        function saveEdit(reviewId) {
            const reviewIndex = reviews.findIndex(r => r.id === reviewId);
            if (reviewIndex === -1) return;

            const name = document.getElementById(`edit-name-${reviewId}`).value.trim();
            const email = document.getElementById(`edit-email-${reviewId}`).value.trim();
            const rating = parseInt(document.getElementById(`edit-rating-${reviewId}`).value);
            const comment = document.getElementById(`edit-comment-${reviewId}`).value.trim();

            if (!name || !email || !comment || !rating) {
                showStatus('Please fill in all fields', 'error');
                return;
            }

            reviews[reviewIndex] = {
                ...reviews[reviewIndex],
                name,
                email,
                rating,
                comment
            };

            saveReviews();
            cancelEdit(reviewId);
            showStatus('Review updated successfully!', 'success');
        }

        function cancelEdit(reviewId) {
            document.getElementById(`edit-form-${reviewId}`).classList.add('hidden');
            editingReview = null;
        }

        function deleteReview(reviewId) {
            const review = reviews.find(r => r.id === reviewId);
            if (!review) return;

            if (confirm(`Are you sure you want to delete the review by ${review.name}? This cannot be undone.`)) {
                reviews = reviews.filter(r => r.id !== reviewId);
                saveReviews();
                showStatus('Review deleted successfully!', 'success');
            }
        }

        function generateStars(rating) {
            return '‚≠ê'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
        }

        function formatDate(dateString) {
            try {
                return new Date(dateString).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return dateString;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load reviews on page load
        window.addEventListener('load', loadReviews);
    </script>
</body>
</html>
